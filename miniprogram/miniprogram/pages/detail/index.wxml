<wxs module="utils">
var formatId = function(id) {
  if (!id) return ''
  var idStr = id.toString()
  while (idStr.length < 4) {
    idStr = '0' + idStr
  }
  return '#' + idStr
}
module.exports.formatId = formatId
</wxs>

<view class="container" wx:if="{{pokemon}}">
  <!-- Image Section -->
  <view class="hero-section">
    <!-- Image Stack for Cross-fade -->
    <view class="image-stack">
        <!-- Normal Image -->
        <image 
            class="visual-img {{isShiny ? 'hidden' : 'visible'}}" 
            src="{{pokemon.imageUrl}}" 
            mode="aspectFit" 
        />
        <!-- Shiny Image -->
        <image 
            class="visual-img {{isShiny ? 'visible' : 'hidden'}}" 
            src="{{pokemon.imageShiny}}" 
            mode="aspectFit" 
        />
    </view>
    
    <!-- Shiny Toggle Button (V1.1 Style) -->
    <view class="toggle-wrapper" bindtap="toggleShiny">
      <view class="toggle-btn {{isShiny ? 'active' : ''}}" hover-class="btn-hover" hover-start-time="0" hover-stay-time="100">
        <text class="shiny-icon">{{isShiny ? '✨' : '✨'}}</text>
      </view>
    </view>
  </view>

  <!-- Info Card -->
  <view class="info-card">
    <view class="header">
      <view class="title-row">
        <text class="id">{{utils.formatId(pokemon.id)}}</text>
        <text class="name">{{pokemon.nameZh}}</text>
      </view>
      <text class="name-en">{{pokemon.nameEn}}</text>
    </view>

    <!-- Types -->
    <view class="section">
      <view class="types-row">
        <block wx:for="{{pokemon.types}}" wx:key="*this">
          <type-badge type="{{item}}" size="medium" />
        </block>
      </view>
    </view>

    <!-- Description -->
    <view class="section desc-box">
      <text class="section-title">图鉴介绍</text>
      <text class="desc-text">{{pokemon.desc || '暂无介绍'}}</text>
    </view>

    <!-- Data/Gen -->
    <view class="section meta-row">
      <view class="meta-item">
        <text class="label">世代</text>
        <text class="value">第 {{pokemon.gen}} 世代</text>
      </view>
    </view>
  </view>
</view>

<view class="loading" wx:else>
  <text>加载中...</text>
</view>
