# 宝可梦图鉴小程序 v1.0 测试方案 (Test Plan)

| 文档版本 | 修改日期 | 修改人 | 修改内容 |
| :--- | :--- | :--- | :--- |
| v1.0 | 2026-01-12 | Antigravity | 初稿创建 |

文档依据：
- `1.0版本PRD.md`
- `api_documentation.md`
- `frontend_checklist.md`

---

## 1. 测试环境与依赖说明 (Test Environment)

### 1.1 硬件环境
- **iOS 测试机**: iPhone X 及以上机型 (iOS 15+), 覆盖全面屏与非全面屏。
- **Android 测试机**: 主流品牌 (华为/小米/OPPO) 中高端机型 (Android 10+)。
- **虽然模拟器**: 微信开发者工具最新稳定版。

### 1.2 软件环境
- **微信客户端**: 8.0.x 及以上版本。
- **后台服务**:
  - Dev 环境: `http://localhost:3000` (测试阶段)
  - Prod 环境: `https://api.yourdomain.com` (预发布/上线阶段)
- **数据库**: PostgreSQL (包含 1025 条完整宝可梦数据)。

### 1.3 前置条件
- 测试账号准备 (未注册、已注册、异常状态账号)。
- 数据库预置数据 (Seeding) 完成。

---

## 2. 功能测试用例 (Functional Test Cases)

### 2.1 模块：图鉴列表页 (Home)

| ID | 测试点 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **H-001** | **列表展示** | 数据库有数据 | 进入首页 | grid 布局展示宝可梦图片、编号、名称、属性；首屏加载 20 条。 | P0 |
| **H-002** | **下拉刷新** | - | 下拉页面 | 顶部出现 Loading，数据重新加载，列表重置。 | P1 |
| **H-003** | **触底加载** | 数据 > 20 条 | 滑动到底部 | 底部出现 Loading，追加加载下 20 条数据；列表平滑衔接。 | P0 |
| **H-004** | **搜索 - 中文名** | - | 输入“皮卡丘” -> 点击搜索 | 展示皮卡丘卡片；无数据展示空状态。 | P0 |
| **H-005** | **搜索 - 编号** | - | 输入“25” -> 点击搜索 | 展示 #0025 皮卡丘；搜索“0025”也应匹配。 | P0 |
| **H-006** | **筛选 - 世代** | - | 打开筛选 -> 选择“Gen 1” -> 确定 | 列表仅展示第 1 世代宝可梦。 | P1 |
| **H-007** | **筛选 - 属性** | - | 打开筛选 -> 选择“火” -> 确定 | 列表仅展示包含“火”属性的宝可梦。 | P1 |
| **H-008** | **筛选 - 组合** | - | 选择“Gen 1” + “火” -> 确定 | 列表仅展示第 1 世代且包含火属性的宝可梦。 | P2 |
| **H-009** | **详情跳转** | - | 点击列表现有卡片 | 跳转至详情页，且 ID 参数传递正确。 | P0 |

### 2.2 模块：图鉴详情页 (Detail)

| ID | 测试点 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **D-001** | **信息展示** | - | 进入详情页 | 展示大图、编号、中英文名、属性、世代信息；数据来源于 API。 | P0 |
| **D-002** | **形态切换** | - | 点击/切换“闪光”开关 | 图片切换为闪光形态 (Shiny)；切换过程无明显卡顿。 | P0 |
| **D-003** | **形态切回** | - | 再次点击/切换开关 | 图片恢复为普通形态。 | P1 |
| **D-004** | **返回列表** | - | 点击左上角返回 | 返回列表页，且列表页保留之前的滚动位置和筛选状态（可选，视实现而定）。 | P2 |

### 2.3 模块：用户系统 (Auth)

| ID | 测试点 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **A-001** | **未登录状态** | 未登录 | 点击“我的” Tab | 展示未登录 UI，显示“登录/注册”按钮。 | P1 |
| **A-002** | **注册 - 成功** | - | 输入新用户名、合法密码 -> 点击注册 | 提示注册成功，自动登录，跳转/刷新为已登录态。 | P0 |
| **A-003** | **注册 - 重复** | 用户名已存在 | 输入已存在用户名 -> 点击注册 | Toast 提示“用户名已存在”。 | P1 |
| **A-004** | **登录 - 成功** | 已注册 | 输入正确用户名、密码 -> 点击登录 | 提示登录成功，保存 Token，显示用户信息。 | P0 |
| **A-005** | **登录 - 失败** | - | 输入错误密码 | Visual Feedback (Toast) 提示“账号或密码错误”。 | P1 |
| **A-006** | **退出登录** | 已登录 | 点击“退出登录” | 清除 Token，恢复未登录状态，可以重新登录。 | P1 |
| **A-007** | **Token 持久化** | 已登录 | 杀掉小程序进程 -> 重新打开 | 保持登录状态，无需重新输入密码。 | P0 |

---

## 3. 边界与异常处理场景 (Access & Exception)

### 3.1 网络异常
*   **断网测试**: 在请求发起时断开网络，应弹出“网络连接失败”提示，页面不应白屏/崩溃。
*   **弱网测试**: 使用开发者工具模拟 2G/3G 网络，验证 Loading 态是否正常显示，超时后是否有重试机制或提示。

### 3.2 数据异常
*   **搜索无结果**: 搜索不存在的宝可梦，应展示友好的 Empty State（空状态图 + 文案），而非空白。
*   **列表到底**: 加载完所有 1025 条数据后，底部应提示“没有更多了”，且不再发起请求。
*   **图片加载失败**: 若 CDN 图片 404 或加载超时，应显示默认占位图 (Placeholder)。

### 3.3 接口异常
*   **API 500**: 模拟后端服务挂掉，前端应捕获异常并提示“服务暂时不可用”。
*   **Token 过期 (401)**: 模拟 Token 失效，发起需要鉴权的请求（如获取 Profile），应自动登出并跳转至登录页。

---

## 4. 自动化测试脚本建议 (Automation Strategy)

鉴于项目规模与技术栈，建议采用以下分层测试策略：

### 4.1 单元测试 (Unit Test) - *Optional*
*   **工具**: Jest + `ts-jest`
*   **覆盖范围**:
    *   `utils/` 下的工具函数 (如格式化 ID `#0001`)。
    *   `services/` 下的 API 请求封装与拦截器逻辑。
*   **示例**:
    ```typescript
    test('formatId should return #0025 for input 25', () => {
      expect(formatId(25)).toBe('#0025');
    });
    ```

### 4.2 E2E 自动化测试 (UI Test) - *Recommended*
*   **工具**: **miniprogram-automator** (微信官方自动化 SDK)
*   **核心场景覆盖**:
    1.  启动小程序 -> 首页加载 -> 截图比对。
    2.  点击搜索框 -> 输入 "Pikachu" -> 验证列表包含 ID 25。
    3.  点击列表项 -> 跳转详情页 -> 验证详情页 Title 为 "皮卡丘"。
*   **脚本伪代码 (Demo)**:
    ```javascript
    const automator = require('miniprogram-automator');
    
    automator.launch({ projectPath: 'path/to/project' }).then(async miniProgram => {
      const page = await miniProgram.currentPage();
      await page.waitFor(1000);
      const searchBar = await page.$('.search-bar');
      await searchBar.input('皮卡丘');
      // ... assertions
      await miniProgram.close();
    });
    ```

---

## 5. 性能与兼容性测试要求 (Performance & Compatibility)

### 5.1 性能指标
*   **首屏加载时间 (FMP)**: 冷启动 < 1.5s (WIFI), < 3s (4G)。
*   **滚动帧率**: 列表页快速滑动时 FPS > 50，无明显掉帧。
*   **内存占用**: 长时间使用（浏览 > 50 个详情页后），内存无泄漏，如小程序 crash。
*   **图片优化**: 列表页缩略图大小应控制在 50KB 以内，详情页大图 < 300KB。

### 5.2 兼容性
*   **屏幕适配**:
    *   验证 iPhone X/14/15 底部 Home Indicator 不遮挡 TabBar 或底部操作区。
    *   验证小屏机型 (iPhone SE) 内容不溢出。
*   **操作系统**: 覆盖 iOS 和 Android 默认字体渲染差异。

---
