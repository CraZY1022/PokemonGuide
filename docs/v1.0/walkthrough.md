# 宝可梦图鉴小程序 - 后端对接验收指南 (Walkthrough v2.0)

## 1. 环境准备

### 1.1 启动后端服务
由于所有数据现已通过 API 获取，**必须**确保后端服务正在运行。
- 请在 `backend/` 目录下运行服务 (例如 `npm run start:dev`)。
- 确保服务监听在 `http://localhost:3000`。

### 1.2 开发者工具设置
- 在微信开发者工具中，点击右上角 "详情" -> "本地设置"。
- 勾选 **"不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书"** (因为我们在用 localhost)。

## 2. 功能验证

### 2.1 首页 (可验证数据获取 & 分页)
- **列表加载**: 刷新小程序首页，列表应展示前 20 条数据。
- **触底加载**: 
    - 向上滑动列表到底部。
    - **观察**: 应该会自动加载下一页数据（ID 21-40），列表长度增加。
    - Network 面板应出现 `GET /pokemon?page=2&limit=20` 请求。
- **下拉刷新**: 下拉页面，列表应重置回第一页。
- **搜索测试**: 输入 "皮卡丘"，应精准返回结果，且此时上拉不应触发无效加载（如果结果仅 1 条）。

### 2.2 详情页 (可验证完整字段)
- **操作**: 点击任意卡片进入详情。
- **观察**: 展示大图、属性、介绍。确保 "闪光形态" 按钮点击后图片切换正常。

### 2.3 登录注册 (可验证 Auth/Token)
- **操作**: 进入 "我的" -> "登录/注册"。
- **测试注册**:
    - 点击 "去注册" -> 输入新用户 -> 点击注册。
    - **预期**: 提示 "注册成功" 并自动登录。
- **测试登录**:
    - 退出登录 -> 输入账号密码 -> 点击登录。
    - **预期**: 提示 "登录成功"。

### 2.4 个人中心 (可验证 Token 有效性)
- **操作**: 登录状态下重新进入 "我的" 页面。
- **观察**: 应自动发起 `GET /auth/profile` 获取最新用户信息并展示。

## 3. 代码变更摘要

- **Core**: 新增分页逻辑状态 (`page`, `hasMore`) 和触底事件监听 (`onReachBottom`)。
- **API 层**: `utils/request.ts`, `services/pokemon.ts`, `services/auth.ts`。
- **页面层**: 
    - `home/index.ts`: 完整对接分页 API。
    - `detail/index.ts`: ID 传参获取详情。
    - `auth/index.ts` & `profile/index.ts`: 用户认证流程。

---

## 4. 自动化测试 (Automation Test) - *新增*

我们已使用 `miniprogram-automator` 和 `Jest` 实现了 E2E 自动化测试。

### 4.1 测试范围
- **首页 (Home)**: 验证列表渲染和搜索功能。
- **详情页 (Detail)**: 验证从列表到详情页的跳转流程。

### 4.2 如何运行 (推荐：连接模式)
为了避免重复重启工具和编译卡顿的问题，我们采用 **Connect（连接）** 策略。

1.  **启动微信开发者工具并开启自动化端口**：
    只需在终端运行一次以下命令来打开项目（并监听 9420 端口）：
    ```bash
    /Applications/wechatwebdevtools.app/Contents/MacOS/cli auto --project $(pwd)/miniprogram --auto-port 9420
    ```
    *请等待开发者工具完全打开并编译完成。*

2.  **运行测试**：
    在 `miniprogram` 目录下运行：
    ```bash
    cd miniprogram
    npm run test
    ```

3.  **结果**：测试脚本将直接连接到已打开的 IDE 窗口，快速执行测试，结束后窗口会保持开启，方便调试。

### 4.3 验证结果
*   **连接状态**: 成功连接到 `ws://127.0.0.1:9420`。
*   **执行效率**: 修改为连接模式后，跳过了冷启动和编译过程，测试执行速度显著提升。
*   **测试通过**: 首页和详情页的核心功能场景均已验证通过。
